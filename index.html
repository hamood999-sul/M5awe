<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Coach Hamood</title>
    
    <link rel="icon" href="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'%3E%3Ctext y='.9em' font-size='90'%3EğŸ’ª%3C/text%3E%3C/svg%3E">
    <link rel="apple-touch-icon" href="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'%3E%3Ctext y='.9em' font-size='90'%3EğŸ’ª%3C/text%3E%3C/svg%3E">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">

    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/quagga/0.12.1/quagga.min.js"></script>
    <style>
        body { font-family: 'Segoe UI', sans-serif; background-color: #f0f4f8; touch-action: manipulation; }
        .card { background: white; border-radius: 24px; box-shadow: 0 4px 20px rgba(0,0,0,0.03); }
        #scanner-wrap { width: 100%; max-width: 400px; margin: 0 auto; overflow: hidden; border-radius: 20px; border: 4px solid #3b82f6; height: 220px; position: relative; background: #000; }
        #interactive video { width: 100%; height: 100%; object-fit: cover; }
        .laser { position: absolute; top: 50%; left: 0; right: 0; height: 2px; background: rgba(255, 0, 0, 0.5); box-shadow: 0 0 10px red; animation: scanning 2s infinite; z-index: 10; }
        @keyframes scanning { 0%, 100% { top: 25%; } 50% { top: 75%; } }
        .fav-food-btn { transition: all 0.2s; border: 1px solid #e2e8f0; background: white; padding: 8px 12px; border-radius: 12px; font-size: 11px; font-weight: bold; color: #475569; user-select: none; -webkit-tap-highlight-color: transparent; }
        .fav-food-btn:active { background-color: #f1f5f9; transform: scale(0.95); }
        #progress-bar { transition: width 0.5s ease-in-out; }
    </style>
</head>
<body class="p-4 pb-24">

    <div class="card p-6 mb-4 border-t-8 border-blue-600">
        <div class="flex justify-between items-center mb-4">
            <input type="date" id="date-picker" onchange="changeDate()" class="bg-gray-100 rounded-lg px-2 py-1 text-xs font-bold outline-none">
            <button onclick="editGoals()" class="text-xs bg-blue-50 text-blue-600 px-3 py-1 rounded-full font-bold">Ø§Ù„Ø£Ù‡Ø¯Ø§Ù âš™ï¸</button>
        </div>
        
        <div class="text-center mb-2">
            <div class="flex items-baseline justify-center gap-1">
                <span id="total-calories" class="text-5xl font-black text-slate-800">0</span>
                <span class="text-gray-400 font-bold">/ <span id="goal-display">2500</span></span>
            </div>
            <div id="remaining-label" class="text-[11px] font-bold mt-1 uppercase tracking-wider">Ø¨Ø§Ù‚ÙŠ Ù„Ùƒ: <span id="calories-left">0</span> Ø³Ø¹Ø±Ø©</div>
        </div>

        <div class="w-full bg-gray-100 h-3 rounded-full overflow-hidden mb-4 border border-gray-50">
            <div id="progress-bar" class="bg-blue-600 h-full w-0"></div>
        </div>

        <div class="flex gap-2 text-center">
            <div class="flex-1 bg-orange-50 p-2 rounded-xl border border-orange-100"><small class="block text-[9px] text-orange-400 font-bold uppercase">Prot</small><b id="total-protein">0</b>g</div>
            <div class="flex-1 bg-blue-50 p-2 rounded-xl border border-blue-100"><small class="block text-[9px] text-blue-400 font-bold uppercase">Carb</small><b id="total-carbs">0</b>g</div>
            <div class="flex-1 bg-yellow-50 p-2 rounded-xl border border-yellow-100"><small class="block text-[9px] text-yellow-600 font-bold uppercase">Fat</small><b id="total-fat">0</b>g</div>
        </div>
    </div>

    <div class="card p-5 mb-4 border-r-8 border-orange-500">
        <div class="flex justify-between items-center mb-3">
            <h2 class="font-bold text-slate-700 text-sm italic">â­ Ø£ÙƒÙ„Ø§ØªÙŠ Ø§Ù„Ù…ØªÙƒØ±Ø±Ø©</h2>
            <span class="text-[8px] bg-orange-100 text-orange-600 px-2 py-0.5 rounded-full font-bold uppercase tracking-tighter">Ù†Ù‚Ø±ØªÙŠÙ† Ù„Ù„Ø­Ø°Ù ğŸ—‘ï¸</span>
        </div>
        <div id="fav-foods-container" class="flex flex-wrap gap-2">
            <span class="text-gray-300 text-[10px]">Ø£Ø¶Ù Ø£ÙƒÙ„Ø© ÙŠØ¯ÙˆÙŠØ© Ù„ØªØ¸Ù‡Ø± Ù‡Ù†Ø§..</span>
        </div>
    </div>

    <div class="grid grid-cols-2 gap-3 mb-4">
        <div class="card p-4 border-r-4 border-purple-500">
            <div class="flex justify-between items-center mb-2">
                <h2 class="font-bold text-slate-700 text-xs italic">ğŸ‹ï¸â€â™‚ï¸ Ø§Ù„ØªÙ…Ø±ÙŠÙ†</h2>
                <button onclick="addItem('workout')" class="text-purple-600 text-lg">âŠ•</button>
            </div>
            <div id="workout-container" class="flex flex-col gap-1"></div>
        </div>
        <div class="card p-4 border-r-4 border-green-500">
            <div class="flex justify-between items-center mb-2">
                <h2 class="font-bold text-slate-700 text-xs italic">ğŸ’Š Ø§Ù„Ù…ÙƒÙ…Ù„Ø§Øª</h2>
                <button onclick="addItem('supp')" class="text-green-600 text-lg">âŠ•</button>
            </div>
            <div id="supps-container" class="flex flex-col gap-1"></div>
        </div>
    </div>

    <div id="scanner-section" class="hidden mb-4">
        <div id="scanner-wrap">
            <div id="interactive" class="viewport"></div>
            <div class="laser"></div>
            <button onclick="stopScanner()" class="absolute top-2 right-2 bg-red-500 text-white w-8 h-8 rounded-full font-bold z-[60]">âœ•</button>
        </div>
    </div>

    <div class="grid grid-cols-2 gap-4 mb-6">
        <button onclick="startScanner()" class="card p-4 bg-slate-900 text-white font-bold flex flex-col items-center">
            <span class="text-xl">ğŸ“·</span><span class="text-xs mt-1">Ø³ÙƒØ§Ù† Ø¨Ø§Ø±ÙƒÙˆØ¯</span>
        </button>
        <button onclick="showManualAdd()" class="card p-4 bg-white border-2 border-slate-900 font-bold flex flex-col items-center">
            <span class="text-xl">â•</span><span class="text-xs mt-1">Ø¥Ø¶Ø§ÙØ© ÙŠØ¯ÙˆÙŠØ©</span>
        </button>
    </div>

    <div class="card p-5 min-h-[200px]">
        <div class="flex justify-between items-center mb-4 border-b pb-2">
            <h2 class="font-bold text-slate-700">ÙˆØ¬Ø¨Ø§Øª Ø§Ù„ÙŠÙˆÙ…</h2>
            <button onclick="clearDay()" class="text-[10px] text-red-500 font-bold underline">Ù…Ø³Ø­ Ø§Ù„Ø³Ø¬Ù„</button>
        </div>
        <ul id="meals-list" class="space-y-3"></ul>
    </div>

    <div id="modal" class="hidden fixed inset-0 bg-slate-900/95 backdrop-blur-md flex items-center justify-center p-6 z-[100]">
        <div class="bg-white p-7 rounded-[35px] w-full max-w-sm">
            <h3 id="p-name" class="font-black text-lg mb-4 text-center text-slate-800 italic uppercase">Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù„ÙŠÙ„...</h3>
            <div id="p-stats" class="text-center text-xs text-blue-600 mb-4 font-bold"></div>
            <input type="number" id="amount-input" class="w-full border-2 border-slate-100 p-4 rounded-2xl mb-6 text-center text-3xl outline-none focus:border-blue-500" placeholder="Ø§Ù„ÙƒÙ…ÙŠØ© (ØºØ±Ø§Ù…)">
            <button onclick="saveMeal()" class="w-full bg-blue-600 text-white py-4 rounded-2xl font-black text-lg shadow-lg">ØªØ£ÙƒÙŠØ¯ Ø§Ù„Ø¥Ø¶Ø§ÙØ©</button>
            <button onclick="closeModal()" class="w-full text-slate-400 mt-4 text-sm font-bold">Ø¥Ù„ØºØ§Ø¡</button>
        </div>
    </div>

    <script>
        let allData = JSON.parse(localStorage.getItem('gymApp_Data')) || {};
        let suppsTaken = JSON.parse(localStorage.getItem('gymApp_Supps')) || {};
        let workoutsDone = JSON.parse(localStorage.getItem('gymApp_Workouts')) || {};
        let goals = JSON.parse(localStorage.getItem('gymApp_Goals')) || { cal: 2500, prot: 150 };
        let myFavFoods = JSON.parse(localStorage.getItem('gymApp_FavFoods')) || [];

        let MY_SUPPS = JSON.parse(localStorage.getItem('gymApp_SuppsList')) || ["Ø¬ÙŠÙ†ÙŠØ³ÙŠØº", "ÙÙŠØªØ§Ù…ÙŠÙ† C", "Ø§Ù…ÙŠÙ†Ùˆ 2222", "Mk-677", "Ù…Ø§ØºÙ†ÙŠØ³ÙŠÙˆÙ…", "Ø§ÙˆÙ…ÙŠØ¬Ø§ 3", "D3+K2", "ÙƒØ±ÙŠØ§ØªÙŠÙ†"];
        let MY_WORKOUTS = JSON.parse(localStorage.getItem('gymApp_WorkoutsList')) || ["Push", "Pull", "Leg", "ØµØ¯Ø± + ØªØ±Ø§ÙŠ", "Ø¶Ù‡Ø± + Ø¨Ø§ÙŠ", "Ø§ÙƒØªØ§Ù", "ÙƒØ§Ø±Ø¯ÙŠÙˆ 20", "Ø±Ø§Ø­Ø©"];

        let currentSelectedDate = new Date().toISOString().split('T')[0];
        let tempProd = {};
        let clickTimer = null;

        document.getElementById('date-picker').value = currentSelectedDate;

        async function fetchProductInfo(barcode) {
            stopScanner();
            document.getElementById('p-name').innerText = "Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø¨Ø­Ø«...";
            showModal();
            try {
                const response = await fetch(`https://world.openfoodfacts.org/api/v2/product/${barcode}.json?fields=product_name,nutriments`);
                const data = await response.json();
                if (data.status === 1 || data.product) {
                    const product = data.product;
                    const nut = product.nutriments;
                    tempProd = {
                        name: product.product_name || "Ù…Ù†ØªØ¬ ØºÙŠØ± Ù…Ø¹Ø±ÙˆÙ",
                        cal100: nut['energy-kcal_100g'] || nut['energy-kcal_serving'] || 0,
                        prot100: nut['proteins_100g'] || 0,
                        carb100: 0, fat100: 0
                    };
                    document.getElementById('p-name').innerText = tempProd.name;
                }
            } catch (err) {}
        }

        function renderLists() {
            const fContainer = document.getElementById('fav-foods-container');
            fContainer.innerHTML = myFavFoods.length ? '' : '<span class="text-gray-300 text-[10px]">Ø£Ø¶Ù Ø£ÙƒÙ„Ø© ÙŠØ¯ÙˆÙŠØ© Ù„ØªØ¸Ù‡Ø± Ù‡Ù†Ø§..</span>';
            myFavFoods.forEach((food, index) => {
                const btn = document.createElement('button');
                btn.className = 'fav-food-btn';
                btn.innerText = food.name;
                btn.onclick = () => {
                    if (clickTimer == null) {
                        clickTimer = setTimeout(() => { clickTimer = null; addFavFood(index); }, 300);
                    } else {
                        clearTimeout(clickTimer); clickTimer = null; removeFavFood(index);
                    }
                };
                fContainer.appendChild(btn);
            });
            renderSuppsAndWorkouts();
        }

        function renderSuppsAndWorkouts() {
            const sContainer = document.getElementById('supps-container');
            sContainer.innerHTML = '';
            MY_SUPPS.forEach((s, idx) => {
                const isActive = (suppsTaken[currentSelectedDate] || []).includes(s);
                const btn = document.createElement('button');
                btn.className = `text-right px-2 py-1.5 rounded-lg text-[10px] font-bold border ${isActive ? 'bg-blue-600 text-white' : 'bg-gray-50 text-gray-500'}`;
                btn.innerText = s;
                btn.onclick = () => {
                    if (clickTimer == null) {
                        clickTimer = setTimeout(() => { clickTimer = null; toggleItem(s, 'supp'); }, 300);
                    } else {
                        clearTimeout(clickTimer); clickTimer = null; removeItem(idx, 'supp');
                    }
                };
                sContainer.appendChild(btn);
            });
            const wContainer = document.getElementById('workout-container');
            wContainer.innerHTML = '';
            MY_WORKOUTS.forEach((w, idx) => {
                const isActive = (workoutsDone[currentSelectedDate] || []).includes(w);
                const btn = document.createElement('button');
                btn.className = `text-right px-2 py-1.5 rounded-lg text-[10px] font-bold border ${isActive ? 'bg-purple-600 text-white' : 'bg-gray-50 text-gray-500'}`;
                btn.innerText = w;
                btn.onclick = () => {
                    if (clickTimer == null) {
                        clickTimer = setTimeout(() => { clickTimer = null; toggleWorkout(w); }, 300);
                    } else {
                        clearTimeout(clickTimer); clickTimer = null; removeItem(idx, 'workout');
                    }
                };
                wContainer.appendChild(btn);
            });
        }

        function addItem(type) {
            const val = prompt(type === 'supp' ? "Ø§Ø³Ù… Ø§Ù„Ù…ÙƒÙ…Ù„:" : "Ø§Ø³Ù… Ø§Ù„ØªÙ…Ø±ÙŠÙ†:");
            if (!val) return;
            if (type === 'supp') {
                MY_SUPPS.push(val);
                localStorage.setItem('gymApp_SuppsList', JSON.stringify(MY_SUPPS));
            } else {
                MY_WORKOUTS.push(val);
                localStorage.setItem('gymApp_WorkoutsList', JSON.stringify(MY_WORKOUTS));
            }
            renderLists();
        }

        function removeItem(idx, type) {
            if (confirm("Ø­Ø°Ù Ù‡Ø°Ø§ Ø§Ù„Ø¹Ù†ØµØ± Ù†Ù‡Ø§Ø¦ÙŠØ§Ù‹ØŸ")) {
                if (type === 'supp') {
                    MY_SUPPS.splice(idx, 1);
                    localStorage.setItem('gymApp_SuppsList', JSON.stringify(MY_SUPPS));
                } else {
                    MY_WORKOUTS.splice(idx, 1);
                    localStorage.setItem('gymApp_WorkoutsList', JSON.stringify(MY_WORKOUTS));
                }
                renderLists();
            }
        }

        function removeFavFood(index) {
            if (confirm(`Ø­Ø°Ù Ù…Ù† Ø§Ù„Ù…ÙØ¶Ù„Ø§ØªØŸ`)) {
                myFavFoods.splice(index, 1);
                localStorage.setItem('gymApp_FavFoods', JSON.stringify(myFavFoods));
                renderLists();
            }
        }

        function addFavFood(index) {
            tempProd = myFavFoods[index];
            document.getElementById('p-name').innerText = tempProd.name;
            showModal();
        }

        function showManualAdd() {
            const n = prompt("Ø§Ø³Ù… Ø§Ù„Ø£ÙƒÙ„Ø©:");
            if (!n) return;
            tempProd = { 
                name: n, 
                cal100: parseFloat(prompt("Ø³Ø¹Ø±Ø§Øª Ù„ÙƒÙ„ 100Øº:", "0")) || 0, 
                prot100: parseFloat(prompt("Ø¨Ø±ÙˆØªÙŠÙ† Ù„ÙƒÙ„ 100Øº:", "0")) || 0
            };
            if (!myFavFoods.some(f => f.name === n)) {
                myFavFoods.push(tempProd);
                localStorage.setItem('gymApp_FavFoods', JSON.stringify(myFavFoods));
            }
            document.getElementById('p-name').innerText = n;
            showModal();
        }

        function saveMeal() {
            let val = document.getElementById('amount-input').value; 
            if(!val) return;
            if(!allData[currentSelectedDate]) allData[currentSelectedDate] = [];
            let f = val / 100;
            allData[currentSelectedDate].push({
                name: tempProd.name, amount: val,
                cal: tempProd.cal100 * f, prot: tempProd.prot100 * f
            });
            closeModal();
            updateUI();
        }

        function updateUI() {
            let meals = allData[currentSelectedDate] || [];
            let totals = { cal: 0, prot: 0 };
            const list = document.getElementById('meals-list');
            list.innerHTML = meals.length ? '' : '<div class="text-center py-10 text-gray-300 italic text-xs">Ù„Ø§ ÙŠÙˆØ¬Ø¯ ÙˆØ¬Ø¨Ø§Øª</div>';
            
            meals.forEach((m, i) => {
                totals.cal += m.cal; totals.prot += m.prot;
                list.innerHTML += `<li class="flex justify-between items-center p-3 bg-white border border-slate-50 rounded-2xl shadow-sm">
                    <div class="flex flex-col"><span class="font-bold text-xs">${m.name}</span><span class="text-[9px] text-gray-400">${m.amount} Øº</span></div>
                    <div class="flex items-center gap-3"><div class="text-left font-black text-blue-600 text-[10px]">${Math.round(m.cal)} Cal</div>
                    <button onclick="deleteMeal(${i})" class="text-red-300 px-2 text-lg">âœ•</button></div></li>`;
            });

            const totalCal = Math.round(totals.cal);
            const goalCal = goals.cal;
            const remaining = goalCal - totalCal;
            
            document.getElementById('total-calories').innerText = totalCal;
            document.getElementById('goal-display').innerText = goalCal;
            document.getElementById('total-protein').innerText = Math.round(totals.prot);

            const progressPercent = Math.min((totalCal / goalCal) * 100, 100);
            document.getElementById('progress-bar').style.width = progressPercent + '%';

            const remainingLabel = document.getElementById('remaining-label');
            if (remaining >= 0) {
                remainingLabel.className = "text-[11px] font-bold mt-1 uppercase tracking-wider text-blue-500";
                remainingLabel.innerHTML = `Ø¨Ø§Ù‚ÙŠ Ù„Ùƒ: <span>${remaining}</span> Ø³Ø¹Ø±Ø©`;
                document.getElementById('progress-bar').className = "bg-blue-600 h-full";
            } else {
                remainingLabel.className = "text-[11px] font-bold mt-1 uppercase tracking-wider text-red-500";
                remainingLabel.innerHTML = `ØªØ¬Ø§ÙˆØ²Øª Ø§Ù„Ù‡Ø¯Ù Ø¨Ù€: <span>${Math.abs(remaining)}</span> Ø³Ø¹Ø±Ø© âš ï¸`;
                document.getElementById('progress-bar').className = "bg-red-500 h-full";
            }
            
            localStorage.setItem('gymApp_Data', JSON.stringify(allData));
            renderLists();
        }

        function toggleWorkout(name) {
            if (!workoutsDone[currentSelectedDate]) workoutsDone[currentSelectedDate] = [];
            const idx = workoutsDone[currentSelectedDate].indexOf(name);
            
            if (idx > -1) {
                // Ø¥Ø°Ø§ ÙƒØ§Ù† Ù…ÙˆØ¬ÙˆØ¯Ø§Ù‹ Ø¨Ø§Ù„ÙØ¹Ù„ØŒ Ù†Ù‚ÙˆÙ… Ø¨Ø¥Ø²Ø§Ù„ØªÙ‡ (Ø¥Ù„ØºØ§Ø¡ Ø§Ù„ØªØ­Ø¯ÙŠØ¯)
                workoutsDone[currentSelectedDate].splice(idx, 1);
            } else {
                // Ø¥Ø°Ø§ Ù„Ù… ÙŠÙƒÙ† Ù…ÙˆØ¬ÙˆØ¯Ø§Ù‹ØŒ Ù†ØªØ­Ù‚Ù‚ Ø£ÙˆÙ„Ø§Ù‹ Ù…Ù† Ø§Ù„Ø¹Ø¯Ø¯
                if (workoutsDone[currentSelectedDate].length < 2) {
                    workoutsDone[currentSelectedDate].push(name);
                } else {
                    alert("ÙŠÙ…ÙƒÙ†Ùƒ Ø§Ø®ØªÙŠØ§Ø± ØªÙ…Ø±ÙŠÙ†ÙŠÙ† ÙÙ‚Ø· ÙÙŠ Ø§Ù„ÙŠÙˆÙ…!");
                }
            }
            
            localStorage.setItem('gymApp_Workouts', JSON.stringify(workoutsDone));
            renderLists();
        }

        function toggleItem(name, type) {
            let store = type === 'supp' ? suppsTaken : workoutsDone;
            if (!store[currentSelectedDate]) store[currentSelectedDate] = [];
            const idx = store[currentSelectedDate].indexOf(name);
            if (idx > -1) store[currentSelectedDate].splice(idx, 1);
            else store[currentSelectedDate].push(name);
            localStorage.setItem(type === 'supp' ? 'gymApp_Supps' : 'gymApp_Workouts', JSON.stringify(store));
            renderLists();
        }

        function startScanner() {
            document.getElementById('scanner-section').classList.remove('hidden');
            Quagga.init({
                inputStream: { name: "Live", type: "LiveStream", target: document.querySelector('#interactive'), constraints: { facingMode: "environment" } },
                decoder: { readers: ["ean_reader", "upc_reader"] }
            }, (err) => { if(!err) Quagga.start(); });
            Quagga.onDetected(d => fetchProductInfo(d.codeResult.code));
        }

        function stopScanner() { Quagga.stop(); document.getElementById('scanner-section').classList.add('hidden'); }
        function showModal() { document.getElementById('modal').classList.remove('hidden'); }
        function closeModal() { document.getElementById('modal').classList.add('hidden'); document.getElementById('amount-input').value = ''; }
        function changeDate() { currentSelectedDate = document.getElementById('date-picker').value; updateUI(); }
        function deleteMeal(i) { allData[currentSelectedDate].splice(i, 1); updateUI(); }
        function clearDay() { if(confirm("Ù…Ø³Ø­ Ø³Ø¬Ù„ Ø§Ù„ÙŠÙˆÙ…ØŸ")) { allData[currentSelectedDate] = []; updateUI(); } }
        function editGoals() { 
            let c = prompt("Ø­Ø¯Ø¯ Ù‡Ø¯Ù Ø§Ù„Ø³Ø¹Ø±Ø§Øª Ø§Ù„ÙŠÙˆÙ…ÙŠ:", goals.cal); 
            if(c) { goals.cal = parseInt(c); localStorage.setItem('gymApp_Goals', JSON.stringify(goals)); updateUI(); } 
        }

        updateUI();
    </script>
</body>
</html>
