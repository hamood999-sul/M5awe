<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>Coach Hamood</title>

<link rel="icon" href="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'%3E%3Ctext y='.9em' font-size='90'%3EğŸ’ª%3C/text%3E%3C/svg%3E">

<script src="https://cdn.tailwindcss.com"></script>
<script src="https://unpkg.com/html5-qrcode" type="text/javascript"></script>

<style>
body { font-family: 'Segoe UI', sans-serif; background-color: #f0f4f8; }
.card { background: white; border-radius: 24px; box-shadow: 0 4px 20px rgba(0,0,0,0.03); }
#scanner-wrap { width: 100%; max-width: 400px; margin: 0 auto; overflow: hidden; border-radius: 20px; border: 4px solid #3b82f6; height: 240px; position: relative; background: #000; }
#interactive video { width: 100%; height: 100%; object-fit: cover; }
.laser { position: absolute; top: 50%; left: 0; right: 0; height: 2px; background: rgba(255, 0, 0, 0.5); box-shadow: 0 0 10px red; animation: scanning 2s infinite; z-index: 10; }
@keyframes scanning { 0%,100%{top:25%}50%{top:75%}}
#progress-bar{transition:width .5s ease-in-out}
</style>
</head>

<body class="p-4 pb-24">

<div class="card p-6 mb-4 border-t-8 border-blue-600 text-center">
<div class="flex justify-between items-center mb-4">
<input type="date" id="date-picker" class="bg-gray-100 rounded-lg px-2 py-1 text-xs font-bold outline-none">
<button onclick="editGoals()" class="text-xs bg-blue-50 text-blue-600 px-3 py-1 rounded-full font-bold">Ø§Ù„Ø£Ù‡Ø¯Ø§Ù âš™ï¸</button>
</div>

<div class="flex items-baseline justify-center gap-1">
<span id="total-calories" class="text-5xl font-black text-slate-800">0</span>
<span class="text-gray-400 font-bold">/ <span id="goal-display">2500</span></span>
</div>

<div id="remaining-label" class="text-[11px] font-bold mt-1 text-blue-500">Ø¨Ø§Ù‚ÙŠ Ù„Ùƒ: <span id="calories-left">0</span> Ø³Ø¹Ø±Ø©</div>

<div class="w-full bg-gray-100 h-3 rounded-full overflow-hidden mt-3">
<div id="progress-bar" class="bg-blue-600 h-full w-0"></div>
</div>

<div class="flex gap-2 mt-4 text-center">
<div class="flex-1 bg-orange-50 p-2 rounded-xl"><b id="total-protein">0</b>g Ø¨Ø±ÙˆØªÙŠÙ†</div>
</div>
</div>

<div id="scanner-section" class="hidden mb-4">
<div id="scanner-wrap">
<div id="interactive"></div>
<div class="laser"></div>
<button onclick="stopScanner()" class="absolute top-2 right-2 bg-red-500 text-white w-8 h-8 rounded-full font-bold">âœ•</button>
</div>
</div>

<div class="grid grid-cols-2 gap-4 mb-6">
<button onclick="startScanner()" class="card p-4 bg-slate-900 text-white font-bold flex flex-col items-center">
ğŸ“· Ø³ÙƒØ§Ù† Ø¨Ø§Ø±ÙƒÙˆØ¯
</button>
<button onclick="showManualAdd()" class="card p-4 bg-white border-2 border-slate-900 font-bold">
â• Ø¥Ø¶Ø§ÙØ© ÙŠØ¯ÙˆÙŠØ©
</button>
</div>

<div class="card p-5 min-h-[200px]">
<div class="flex justify-between mb-4 border-b pb-2">
<h2 class="font-bold">ÙˆØ¬Ø¨Ø§Øª Ø§Ù„ÙŠÙˆÙ…</h2>
<button onclick="clearDay()" class="text-red-500 text-xs">Ù…Ø³Ø­ Ø§Ù„Ø³Ø¬Ù„</button>
</div>
<ul id="meals-list" class="space-y-3"></ul>
</div>

<div id="modal" class="hidden fixed inset-0 bg-black/80 flex items-center justify-center p-6">
<div class="bg-white p-6 rounded-3xl w-full max-w-sm">
<h3 id="p-name" class="font-bold text-lg mb-4 text-center">...</h3>
<input type="number" id="amount-input" class="w-full border p-3 rounded-xl mb-4 text-center" placeholder="Ø§Ù„ÙƒÙ…ÙŠØ© (ØºØ±Ø§Ù…)">
<button onclick="saveMeal()" class="w-full bg-blue-600 text-white py-3 rounded-xl font-bold">ØªØ£ÙƒÙŠØ¯</button>
<button onclick="closeModal()" class="w-full mt-3 text-gray-400">Ø¥Ù„ØºØ§Ø¡</button>
</div>
</div>

<script>
let allData = JSON.parse(localStorage.getItem('gymData')) || {};
let goals = JSON.parse(localStorage.getItem('gymGoals')) || {cal:2500};
let currentDate = new Date().toISOString().split('T')[0];
let tempProd = {};
let html5QrCode;

document.getElementById('date-picker').value = currentDate;

function updateUI(){
let meals = allData[currentDate] || [];
let total=0, prot=0;
let list=document.getElementById('meals-list');
list.innerHTML='';
meals.forEach((m,i)=>{
total+=m.cal; prot+=m.prot;
list.innerHTML+=`<li class="flex justify-between bg-white p-3 rounded-xl shadow">
<span>${m.name} (${m.amount}Øº)</span>
<div>${Math.round(m.cal)} Cal 
<button onclick="deleteMeal(${i})" class="text-red-400 ml-2">âœ•</button></div></li>`;
});
document.getElementById('total-calories').innerText=Math.round(total);
document.getElementById('total-protein').innerText=Math.round(prot);
document.getElementById('goal-display').innerText=goals.cal;
document.getElementById('progress-bar').style.width=Math.min((total/goals.cal)*100,100)+'%';
localStorage.setItem('gymData',JSON.stringify(allData));
}

function startScanner(){
document.getElementById('scanner-section').classList.remove('hidden');
html5QrCode=new Html5Qrcode("interactive");
Html5Qrcode.getCameras().then(devices=>{
let cam=devices[0];
html5QrCode.start(
cam.id,
{fps:10, qrbox:{width:250,height:150}},
(decodedText)=>{
stopScanner();
fetchProductInfo(decodedText);
}
);
});
}

function stopScanner(){
if(html5QrCode){
html5QrCode.stop().then(()=>html5QrCode.clear());
}
document.getElementById('scanner-section').classList.add('hidden');
}

async function fetchProductInfo(barcode){
document.getElementById('p-name').innerText="Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø¨Ø­Ø«...";
showModal();
try{
let res=await fetch(`https://de.openfoodfacts.org/api/v2/product/${barcode}.json`);
let data=await res.json();
if(!data.product){document.getElementById('p-name').innerText="ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯";return;}
let p=data.product;
tempProd={
name:p.product_name||"Ù…Ù†ØªØ¬",
cal100:p.nutriments?.['energy-kcal_100g']||0,
prot100:p.nutriments?.['proteins_100g']||0
};
document.getElementById('p-name').innerText=tempProd.name;
}catch{document.getElementById('p-name').innerText="Ø®Ø·Ø£ Ø§ØªØµØ§Ù„";}
}

function showManualAdd(){
let n=prompt("Ø§Ø³Ù… Ø§Ù„Ø£ÙƒÙ„Ø©:");
if(!n)return;
tempProd={name:n,cal100:parseFloat(prompt("Ø³Ø¹Ø±Ø§Øª Ù„ÙƒÙ„ 100Øº:",0))||0,prot100:parseFloat(prompt("Ø¨Ø±ÙˆØªÙŠÙ† Ù„ÙƒÙ„ 100Øº:",0))||0};
showModal();
document.getElementById('p-name').innerText=n;
}

function saveMeal(){
let val=document.getElementById('amount-input').value;
if(!val)return;
if(!allData[currentDate])allData[currentDate]=[];
let f=val/100;
allData[currentDate].push({name:tempProd.name,amount:val,cal:tempProd.cal100*f,prot:tempProd.prot100*f});
closeModal();updateUI();
}

function deleteMeal(i){allData[currentDate].splice(i,1);updateUI();}
function clearDay(){if(confirm("Ù…Ø³Ø­ Ø§Ù„ÙŠÙˆÙ…ØŸ")){allData[currentDate]=[];updateUI();}}
function closeModal(){document.getElementById('modal').classList.add('hidden');document.getElementById('amount-input').value='';}
function showModal(){document.getElementById('modal').classList.remove('hidden');}
function editGoals(){let c=prompt("Ù‡Ø¯Ù Ø§Ù„Ø³Ø¹Ø±Ø§Øª:",goals.cal);if(c){goals.cal=parseInt(c);localStorage.setItem('gymGoals',JSON.stringify(goals));updateUI();}}

updateUI();
</script>
</body>
</html>
